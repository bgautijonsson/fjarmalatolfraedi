---
title: "Skilaverkefni 3"
author:
- "Brynjólfur Gauti Jónsson"
- "Þórarinn Jónmundsson"
output:
  pdf_document:
    includes:
      in_header: fjarm_snidmat.tex
    latex_engine: xelatex
  html_document:
    df_print: paged
    theme: cerulean
---

```{r setup, include=FALSE}
# echo = TRUE: Sýna kóða
# message = FALSE: Ekki sýna óþarfa skilaboð í ritgerð
# warning = FALSE: Ekki sýna viðvaranir í ritgerð
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.pos = 'h')

```

```{r, results = 'hide'}
packages <- c("tidyverse", "ggthemes", "knitr", "kableExtra", "scales", "ggforce", "ggsci",
              "broom")
sapply(packages, require, character.only = TRUE, quietly = TRUE)
options(knitr.table.format = "latex", knitr.kable.NA = "")
theme_set(theme_tufte(base_size = 14) +
                theme(panel.border = element_rect(fill = NA),
                      panel.grid.major = element_line(color = "gray78"),
                      legend.background = element_rect(),
                      legend.position = "top"))
```

# Dæmi 1

Ný aðferð til að mæla fosfór í jarðvegi er kynnt til sögunnar. Úrtak af 11 jarðvegssýnum úr jarðvegi með raunverugeu fosfórmagni $548 mg/kg$ er greint með nýju aðferðinni. Úrtaksmeðaltalið reynist vera 587 og úrtaksstaðalfrávikið 10.

**(1)** Gefa gögnin til kynna að nýja aðferðin mæli fosfórmagnið rétt? Nota skal núlltilgátupróf með marktektarkröfu $\alpha = 0.05$.

**(2)** Hverju þurfum við að gera ráð fyrir til að núlltilgátuprófið í **(1)** verði viðeigandi?


\newpage

# Dæmi 2

Framleiðslufyrirtæki þarf að velja á milli tveggja birgja sem selja örflögur í tölvur. Slembiúrtak af 200 örflögum frá birgi *A* eru kannaðar og 8 þeira reyndust vera gallaðar, á meðan 13 í slembiúrtaki af 250 örflögum frá brgi *B* voru gallaðar. Notið núltilgátu til að meta hvort þessi niðurstaða ætti aðhafa áhrif á val fyrirtækisins á birgi með marktektarkröfu $\alpha = 0.01$.




\newpage

# Dæmi 3

Í þessu dæmi á að skila R kóða ásamt svörum. Rannsókn var gerð til að ákvarða samband milli vikulegra útgjalda til auglýsinga og söluhagnaðs. Niðurstaðan var eftirfarandi:

```{r}
data <- data_frame(x = c(40, 20, 25, 20, 30, 
                         50, 40, 20, 50, 40, 25, 50),
                   y = c(385, 400, 395, 365, 475, 440, 
                         490, 420, 560, 525, 480, 510))

data %>%
      set_names(c("Útgjöld til auglýsinga [mISK]", "Söluhagnaður [mISK]")) %>%
      kable(format = "latex", booktabs = TRUE, align = c("c", "c")) %>%
      kable_styling(full_width = TRUE, font_size = 9)
```

**(a)** Notið R til að gera línulega aðhvarfsgreiningu á gögnunum með því að nota formúlurnar í bókinni beint og ákvarðið þannig jöfnu matlínunnar fyrir $Y = \beta_0 + \beta_1x$. Teiknið gögnin.

```{r, echo = TRUE, fig.height = 3.5}
x <- data %>% mutate(x0 = 1) %>% select(x0, x) %>% as.matrix
y <- as.matrix(data$y)
hat_matrix <- 
betas <- solve(t(x) %*% x) %*% t(x) %*% y
fmla <- paste0("Y = ", round(betas[1], 2), " + ", round(betas[2], 2), "x")
ggplot(data, aes(x, y)) + geom_point() +
      geom_abline(intercept = betas[1], slope = betas[2]) +
      geom_text(aes(x = 30, y = 525, label = fmla))
```



**(b)** Ákvarðið 95% öryggisbil fyrir $\beta_1$ með því að reikna sjálf í R.

```{r, echo = TRUE}
e <- y - (x %*% betas)
sigma2 <- ((t(e) %*% e) / (nrow(y) - nrow(betas))) %>% as.vector
var_beta <- solve(t(x) %*% x)  %>% diag %>% as.vector %>% (function(x) x * sigma2)
se_beta <- sqrt(var_beta)

data_frame(beta = as.vector(betas), se = se_beta) %>%
      mutate(lower = beta + qt(0.025, nrow(y)) * se,
             upper = beta + qt(0.975, nrow(y)) * se)

qt(c(0.025, 0.975), nrow(y))
```   


**(c)** Notið fallið `lm(y ~ x)` og staðfestið reikningana í **(a)** og **(b)**.

```{r, echo = TRU}
lm(y ~ x, data = data) %>%
      tidy %>%
      kable(format = "latex", booktabs = TRUE, digits = 3) %>%
      kable_styling(full_width = TRUE)
```


**(d)** Spáið fyrir vikulegum söluhagnaði þegar útgjöld til auglýsinga eru 35 milljónir ISK.

**(e)** Á 5% prófsstigi, getum við dregið þá ályktun að auglýsingar hafi áhrif á sölur?

**(Auka)** Hvernig skal túlka $\beta_0$ og $\beta_1$ fyrir þessi gögn?
